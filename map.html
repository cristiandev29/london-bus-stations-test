<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg&v=weekly&libraries=geometry"></script>
    <style type="text/css">
      /* 
 * Always set the map height explicitly to define the size of the div element
 * that contains the map. 
 */
      #map {
        height: 100%;
      }

      /* 
 * Optional: Makes the sample page fill the window. 
 */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>

  <body>
    <a href="#jaja"> Link </a>
    <div id="map"></div>
    <div id="jaja">afadsfasdfsd</div>
    <script>
      const map = new google.maps.Map(document.getElementById("map"), {
        center: new google.maps.LatLng(51.503, -0.1021),
        zoom: 12,
        fullscreenControl: false,
        mapTypeControl: false,
        stylers: [
          {
            featureType: "poi",
            elementType: "all",
            stylers: [
              {
                visibility: "off",
              },
            ],
          },
          {
            featureType: "poi.park",
            elementType: "all",
            stylers: [
              {
                visibility: "on",
              },
            ],
          },
          {
            featureType: "transit.station",
            elementType: "all",
            stylers: [
              {
                visibility: "off",
              },
            ],
          },
        ],
      });

      let mapPolygon;

      /** CHECK POINT *************************************************/
      const checkPointsCoordinates = [
        { lat: 40.4531101, lng: -3.689555 },
        { lat: 51.508044, lng: -0.126487 },
      ];

      /** CHECK POINT *************************************************/

      function addMarker(location) {
        marker = new google.maps.Marker({
          position: location,
          map: map,
          title: "Bus Stop",
          icon: "https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png",
        });
      }

      function getMapVisibleArea() {
        neLat = map.getBounds().getNorthEast().lat();
        neLng = map.getBounds().getNorthEast().lng();
        swLat = map.getBounds().getSouthWest().lat();
        swLng = map.getBounds().getSouthWest().lng();

        nwLat = new google.maps.LatLng(neLat, swLng).lat();
        nwLng = new google.maps.LatLng(neLat, swLng).lng();

        seLat = new google.maps.LatLng(swLat, neLng).lat();
        seLng = new google.maps.LatLng(swLat, neLng).lng();

        const mapPolygonCords = [
          { lat: neLat, lng: neLng },
          { lat: nwLat, lng: nwLng },
          { lat: swLat, lng: swLng },
          { lat: seLat, lng: seLng },
        ];

        mapPolygon = new google.maps.Polygon({
          paths: mapPolygonCords,
          strokeColor: "#FF0000",
          strokeOpacity: 0.8,
          strokeWeight: 3,
          fillColor: "#FF0000",
          fillOpacity: 0.35,
        });
      }

      function checkIfPointIsInMap(coordinates) {
        coordinates.forEach((item) => {
          const { lat, lng } = item;
          const checkPoint = new google.maps.LatLng(lat, lng);

          // const resultColor = google.maps.geometry.poly.containsLocation(
          //   checkPoint,
          //   mapPolygon
          // )
          //   ? "blue"
          //   : "red";

          // const resultPath = google.maps.geometry.poly.containsLocation(
          //   checkPoint,
          //   mapPolygon
          // )
          //   ? // A triangle.
          //     "m 0 -1 l 1 2 -2 0 z"
          //   : google.maps.SymbolPath.CIRCLE;
          if (
            google.maps.geometry.poly.containsLocation(checkPoint, mapPolygon)
          ) {
            addMarker(checkPoint);
          }

          // new google.maps.Marker({
          //   position: checkPoint,
          //   map,
          //   icon: {
          //     path: resultPath,
          //     fillColor: resultColor,
          //     fillOpacity: 0.2,
          //     strokeColor: "white",
          //     strokeWeight: 0.5,
          //     scale: 10,
          //   },
          // });
        });
      }

      google.maps.event.addListenerOnce(map, "idle", function () {
        // console.log("vamos a aÃ±adir un marker");
        // SantiagoBernabeu = new google.maps.LatLng(40.4531101, -3.689555);
        // addMarker(SantiagoBernabeu);

        // neLat = map.getBounds().getNorthEast().lat();
        // neLng = map.getBounds().getNorthEast().lng();
        // swLat = map.getBounds().getSouthWest().lat();
        // swLng = map.getBounds().getSouthWest().lng();

        // nwLat = new google.maps.LatLng(neLat, swLng).lat();
        // nwLng = new google.maps.LatLng(neLat, swLng).lng();

        // seLat = new google.maps.LatLng(swLat, neLng).lat();
        // seLng = new google.maps.LatLng(swLat, neLng).lng();

        // const mapPolygonCords = [
        //   { lat: neLat, lng: neLng },
        //   { lat: nwLat, lng: nwLng },
        //   { lat: swLat, lng: swLng },
        //   { lat: seLat, lng: seLng },
        // ];

        // mapPolygon = new google.maps.Polygon({
        //   paths: mapPolygonCords,
        //   strokeColor: "#FF0000",
        //   strokeOpacity: 0.8,
        //   strokeWeight: 3,
        //   fillColor: "#FF0000",
        //   fillOpacity: 0.35,
        // });

        getMapVisibleArea();
        // mapPolygon.setMap(map);
        // CHECK POINTS
        checkIfPointIsInMap(checkPointsCoordinates);
      });

      google.maps.event.addListener(map, "dragend", function () {
        getMapVisibleArea();
        // mapPolygon.setMap(map);
        // CHECK POINTS
        checkIfPointIsInMap(checkPointsCoordinates);
      });

      google.maps.event.addListener(map, "zoom_changed", function () {
        getMapVisibleArea();
        // mapPolygon.setMap(map);
        // CHECK POINTS
        checkIfPointIsInMap(checkPointsCoordinates);
      });

      google.maps.event.addListener(map, "click", (e) => {
        // const resultColor = google.maps.geometry.poly.containsLocation(
        //   e.latLng,
        //   mapPolygon
        // )
        //   ? "blue"
        //   : "red";
        // const resultPath = google.maps.geometry.poly.containsLocation(
        //   e.latLng,
        //   mapPolygon
        // )
        //   ? // A triangle.
        //     "m 0 -1 l 1 2 -2 0 z"
        //   : google.maps.SymbolPath.CIRCLE;
        // new google.maps.Marker({
        //   position: e.latLng,
        //   map,
        //   icon: {
        //     path: resultPath,
        //     fillColor: resultColor,
        //     fillOpacity: 0.2,
        //     strokeColor: "white",
        //     strokeWeight: 0.5,
        //     scale: 10,
        //   },
        // });
      });
    </script>
  </body>
</html>
